<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Choose a Template - Presentation Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';
      import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
      import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
      
      const firebaseConfig = {
        apiKey: "AIzaSyDPzRqV-_hGNedZoeGNtorLTGWTBMmqdkc",
        authDomain: "prj-adc-gcp-coop-test.firebaseapp.com",
        projectId: "prj-adc-gcp-coop-test",
        storageBucket: "prj-adc-gcp-coop-test.firebasestorage.app",
        messagingSenderId: "472242813268",
        appId: "1:472242813268:web:4e7b4650015fd473d4f0c1",
        measurementId: "G-RGEPGD1T9T"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app, 'bettercallus');
      const auth = getAuth(app);
      
      // Make available globally
      window.firebaseApp = app;
      window.firebaseAnalytics = analytics;
      window.firebaseDb = db;
      window.firebaseAuth = auth;

      const storedUserId = localStorage.getItem('pm-user-id');
      if (storedUserId) {
        window.currentUserId = storedUserId;
      }

      let lastDispatchedUserId = null;
      const dispatchUserReady = (userId) => {
        if (!userId || userId === lastDispatchedUserId) {
          return;
        }
        lastDispatchedUserId = userId;
        window.dispatchEvent(new CustomEvent('pm-user-ready', { detail: { userId } }));
      };

      if (storedUserId) {
        window.setTimeout(() => dispatchUserReady(storedUserId), 0);
      }
      
      onAuthStateChanged(auth, (user) => {
        if (user) {
          window.currentUserId = user.uid;
          localStorage.setItem('pm-user-id', user.uid);
          if (user.email) {
            localStorage.setItem('pm-user-email', user.email);
          }
          localStorage.setItem('pm-logged-in', 'true');
          dispatchUserReady(user.uid);
          console.log('User authenticated in templates:', user.uid);
        } else if (storedUserId) {
          window.currentUserId = storedUserId;
          dispatchUserReady(storedUserId);
          console.log('Using stored user ID in templates:', storedUserId);
        } else {
          localStorage.removeItem('pm-logged-in');
          window.location.replace('login.html');
        }
      });
      
      console.log('Firebase initialized in templates with database: bettercallus');
    </script>
    <script>
      if (localStorage.getItem('pm-logged-in') !== 'true') {
        window.location.replace('login.html')
      }
    </script>
  </head>
  <body class="bg-white text-slate-900 antialiased">
    <link rel="stylesheet" href="./templates.css">
    <div class="flex min-h-screen bg-white text-slate-900">
      <aside class="hidden w-44 flex-shrink-0 flex-col justify-between border-r border-slate-200 bg-white py-5 text-slate-700 md:flex">
        <div>
          <div class="px-3">
            <div class="flex items-center gap-3">
              <div class="flex h-9 w-9 items-center justify-center rounded-full bg-emerald-500/10 text-xs font-semibold text-emerald-700 ring-1 ring-emerald-500/40" data-user-initials>RA</div>
              <div>
                <p class="text-sm font-semibold uppercase tracking-wide text-slate-900" data-user-name>Renad Alm.</p>
                <p class="text-xs text-slate-400">Workspace</p>
              </div>
            </div>
          </div>
          <nav class="mt-6 space-y-1.5 px-1.5">
            <a href="index.html" class="flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition hover:bg-emerald-50 hover:text-emerald-700" data-nav-link="home">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10.707 1.293a1 1 0 0 0-1.414 0l-7 7a1 1 0 0 0 1.414 1.414L4 8.414V17a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3h2v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1V8.414l.293.293a1 1 0 0 0 1.414-1.414l-7-7Z"/>
              </svg>
              Home
            </a>
            <a href="editor.html?new=1" class="flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition hover:bg-emerald-50 hover:text-emerald-700" data-nav-link="new">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
              </svg>
              New
            </a>
            <a href="#recent" class="flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition hover:bg-emerald-50 hover:text-emerald-700" data-nav-link="recent">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h6"/>
                <circle cx="12" cy="12" r="9"/>
              </svg>
              Recent
            </a>
            <a href="#shared" class="flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition hover:bg-emerald-50 hover:text-emerald-700" data-nav-link="shared">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              Shared
            </a>
            <a href="#open" class="flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition hover:bg-emerald-50 hover:text-emerald-700" data-nav-link="open">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7a2 2 0 0 1 2-2h3.172a2 2 0 0 1 1.414.586l1.828 1.828a2 2 0 0 0 1.414.586H19a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7Z"/>
              </svg>
              Open
            </a>
          </nav>
        </div>
      </aside>
      <div class="flex flex-1 flex-col">
        <header class="mx-auto w-full max-w-7xl px-4 py-6 flex items-center justify-start">
      <img src="assets/aramco-digital-logo.png" alt="Aramco Digital" style="width:auto; height:58px;" />
    </header>

        <main class="relative isolate flex-1">
      <div class="absolute inset-x-0 -top-20 -z-10 blur-3xl opacity-40" aria-hidden="true">
        <div class="mx-auto aspect-[4/1] max-w-4xl bg-gradient-to-r from-emerald-400 via-teal-300 to-sky-400"></div>
      </div>

      <section class="mx-auto max-w-6xl px-6 pb-16">
        <div class="mb-10 flex flex-col gap-6" id="recent">
          <div class="relative overflow-hidden rounded-3xl border border-emerald-100 bg-white px-8 py-10 text-slate-900 shadow-xl shadow-emerald-500/10">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"140\" height=\"140\" viewBox=\"0 0 160 160\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Ccircle cx=\"40\" cy=\"40\" r=\"1\" fill=\"rgba(16,185,129,0.08)\"/%3E%3Ccircle cx=\"120\" cy=\"120\" r=\"1\" fill=\"rgba(20,184,166,0.08)\"/%3E%3Ccircle cx=\"40\" cy=\"120\" r=\"1\" fill=\"rgba(14,165,233,0.04)\"/%3E%3Ccircle cx=\"120\" cy=\"40\" r=\"1\" fill=\"rgba(16,185,129,0.05)\"/%3E%3C/svg%3E')] opacity-70"></div>
            <div class="absolute -top-24 -right-16 h-56 w-56 rounded-full bg-gradient-to-br from-emerald-200/60 via-teal-100/50 to-sky-200/30 blur-3xl"></div>
            <div class="absolute bottom-0 left-0 h-32 w-full bg-gradient-to-r from-emerald-100/40 via-transparent to-sky-100/40"></div>
            <div class="relative flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
              <div>
                <p class="text-sm font-semibold uppercase tracking-[0.3em] text-emerald-500">Welcome back</p>
                <h1 class="mt-3 text-3xl sm:text-4xl font-semibold tracking-tight text-slate-900" data-dashboard-greeting>Pick a template to get started</h1>
                <div class="mt-5 flex h-2 w-28 items-center overflow-hidden rounded-full bg-emerald-500/15">
                  <span class="h-full w-1/2 rounded-full bg-gradient-to-r from-emerald-500 via-teal-400 to-sky-500"></span>
                </div>
                <p class="mt-4 max-w-xl text-base text-slate-600" data-dashboard-subtitle>Let’s craft something remarkable today.</p>
              </div>
              <div class="flex flex-col items-start gap-4 rounded-2xl border border-emerald-100/70 bg-emerald-50/70 px-5 py-4 backdrop-blur">
                <div class="inline-flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-1 text-sm font-semibold text-emerald-700">
                  <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
                  <span data-active-count-label>0 active decks</span>
                </div>
                <div class="space-y-2 text-sm text-slate-700">
                  <div class="flex items-center gap-3 rounded-2xl bg-white px-4 py-3 shadow-sm shadow-emerald-500/10">
                    <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-500/10 text-base font-semibold text-emerald-600">1</span>
                    <div>
                      <p class="font-semibold leading-tight text-slate-900">New template this week</p>
                      <p class="text-xs text-slate-500">Blank canvas refreshed with exec branding.</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-3 rounded-2xl bg-white px-4 py-3 shadow-sm shadow-emerald-500/10">
                    <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/10 text-base font-semibold text-sky-600">2</span>
                    <div>
                      <p class="font-semibold leading-tight text-slate-900">Feedback requests</p>
                      <p class="text-xs text-slate-500">Slide notes awaiting review today.</p>
                    </div>
                  </div>
                  <div class="flex items-center gap-3 rounded-2xl bg-white px-4 py-3 shadow-sm shadow-emerald-500/10">
                    <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-amber-500/10 text-base font-semibold text-amber-600">Fri</span>
                    <div>
                      <p class="font-semibold leading-tight text-slate-900">Next deadline</p>
                      <p class="text-xs text-slate-500">Sustainability briefing due Friday 4 PM.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-emerald-100 bg-white/80 px-4 py-3 shadow-sm backdrop-blur" data-quick-actions>
            <div class="text-sm font-semibold text-emerald-700 uppercase tracking-[0.25em]">Quick actions</div>
            <div class="flex flex-wrap items-center gap-2">
              <button class="group inline-flex items-center gap-2 rounded-full border border-emerald-200 bg-white px-4 py-2 text-sm font-medium text-emerald-700 shadow-sm transition hover:border-emerald-400 hover:shadow-md" data-action="import">
                <span class="h-2 w-2 rounded-full bg-emerald-500 group-hover:scale-125 transition"></span>
                Import PowerPoint
              </button>
              <button class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-400" data-action="share">
                <span class="h-2 w-2 rounded-full bg-white/80"></span>
                Share with team
              </button>
              <button class="group inline-flex items-center gap-2 rounded-full border border-sky-200 bg-white px-4 py-2 text-sm font-medium text-sky-600 shadow-sm transition hover:border-sky-400 hover:shadow-md" data-action="schedule">
                <span class="h-2 w-2 rounded-full bg-sky-500 group-hover:scale-125 transition"></span>
                Schedule review
              </button>
            </div>
            <input id="quick-import-input" type="file" accept=".ppt,.pptx,.pdf" class="hidden" />
          </div>

          <div class="mt-3 hidden items-center gap-2 rounded-xl border px-4 py-3 text-sm shadow-sm" data-action-message>
            <span class="h-2 w-2 rounded-full" data-action-indicator></span>
            <span data-action-message-text></span>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
          <!-- Aramco Style 1 -->
          <div class="group rounded-xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden w-full max-w-lg sm:max-w-md mx-auto transition transform duration-200 hover:-translate-y-1 hover:ring-emerald-400 hover:ring-2 hover:shadow-md">
            <div class="aspect-[16/10] relative">
              <div class="absolute inset-0 bg-white"></div>
              <div class="absolute left-0 top-0 h-full w-2 bg-emerald-500"></div>
              <div class="absolute right-4 top-4 h-3 w-20 bg-gradient-to-r from-emerald-500 via-teal-400 to-sky-500 rounded"></div>
              <div class="absolute left-4 bottom-4 h-2 w-28 bg-slate-200 rounded"></div>
            </div>
            <div class="p-4 flex items-center justify-between gap-4">
              <div class="flex-1">
                <h3 class="font-semibold">Blank</h3>
                <p class="mt-1 text-xs text-slate-500">Start from scratch with a clean slate.</p>
              </div>
              <a href="editor.html?template=clean&new=1" class="inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500">Use</a>
            </div>
          </div>

          <!-- Aramco Style 2 -->
          <div class="group rounded-xl bg-white ring-1 ring-slate-200 shadow-sm overflow-hidden w-full max-w-lg sm:max-w-md mx-auto transition transform duration-200 hover:-translate-y-1 hover:ring-emerald-400 hover:ring-2 hover:shadow-md">
            <div class="aspect-[16/10] relative">
              <div class="absolute inset-0 bg-gradient-to-br from-emerald-50 to-sky-50"></div>
              <div class="absolute bottom-0 right-0 translate-x-6 translate-y-6 h-40 w-40 rounded-full bg-gradient-to-tr from-emerald-400 via-teal-300 to-sky-500 opacity-40 blur-xl"></div>
              <div class="absolute left-4 top-4 h-3 w-24 bg-slate-200 rounded"></div>
              <div class="absolute left-4 top-8 h-2 w-36 bg-slate-200/70 rounded"></div>
            </div>
            <div class="p-4 flex items-center justify-between gap-4">
              <div class="flex-1">
                <h3 class="font-semibold">AD Template</h3>
              </div>
              <a href="editor.html?template=gradient&new=1" class="inline-flex items-center rounded-md bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500">Use</a>
            </div>
          </div>

        </div>

        <hr class="mt-8 border-t border-emerald-200" />

        <section class="mt-12 rounded-2xl bg-slate-50 p-6 sm:p-8 ring-1 ring-slate-200">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Recent Work</h2>
              <p class="mt-1 text-sm text-slate-600">
                PowerPoint-ready decks inspired by Canva layouts—polished, on-brand, and presentation room ready.
              </p>
            </div>
            <a
              href="#"
              class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-500"
            >
              View all decks
            </a>
          </div>

          <div class="mt-6 flex items-center gap-2 text-sm text-slate-500 hidden" data-user-presentations-loading>
            <span class="inline-flex h-2 w-2 animate-pulse rounded-full bg-emerald-500"></span>
            Loading your saved decks...
          </div>
          <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 hidden" data-user-presentations-list></div>
          <div class="mt-6 rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-sm text-slate-500" data-user-presentations-empty>
            Saved presentations will appear here once you create your first deck.
          </div>
        </section>

        <section id="shared" class="mt-12 rounded-2xl bg-slate-50 p-6 sm:p-8 ring-1 ring-slate-200">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Shared with you</h2>
              <p class="mt-1 text-sm text-slate-600">
                PowerPoint-ready decks inspired by Canva layouts—polished, on-brand, and presentation room ready.
              </p>
            </div>
            <a
              href="#"
              class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-500"
            >
              View all decks
            </a>
          </div>

          <div class="mt-6 rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-sm text-slate-500">
            Shared presentations will appear here once someone invites you to collaborate.
          </div>
        </section>

        <section id="open" class="mt-12 rounded-2xl bg-slate-50 p-6 sm:p-8 ring-1 ring-slate-200">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Open from cloud</h2>
              <p class="mt-1 text-sm text-slate-600">
                Quick access to SharePoint decks so you can sync slides without leaving the workspace.
              </p>
            </div>
            <a
              href="#"
              class="inline-flex items-center gap-2 rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-500"
              data-cloud-connect
            >
              Connect account
            </a>
          </div>

          <div
            class="mt-6 rounded-xl border border-dashed border-slate-300 bg-white p-6 text-center text-sm text-slate-500"
            data-cloud-empty
          >
            Connect your enterprise storage to see recent cloud presentations here.
          </div>

          <div class="mt-6 hidden rounded-xl border border-emerald-100 bg-white p-6 shadow-sm" data-cloud-files>
            <div class="flex items-center justify-between border-b border-slate-100 pb-4 text-sm text-slate-500">
              <span>Connected as <span class="font-semibold text-slate-800" data-cloud-user></span></span>
              <button class="text-xs font-semibold text-emerald-600 hover:text-emerald-700" data-cloud-disconnect>Disconnect</button>
            </div>
            <ul class="mt-4 space-y-3 text-sm text-slate-700">
              <li class="flex items-center justify-between rounded-lg border border-slate-200 px-4 py-3">
                <div>
                  <p class="font-semibold text-slate-900">Quarterly Results 2025.pptx</p>
                  <p class="text-xs text-slate-500">Modified 3 hours ago • Finance</p>
                </div>
                <a href="https://sharepoint.com/sites/yourteam/Shared%20Documents/Quarterly%20Results%202025.pptx" target="_blank" rel="noopener" class="text-xs font-semibold text-emerald-600 hover:text-emerald-700">Open</a>
              </li>
              <li class="flex items-center justify-between rounded-lg border border-slate-200 px-4 py-3">
                <div>
                  <p class="font-semibold text-slate-900">Innovation Sprint Brief.pptx</p>
                  <p class="text-xs text-slate-500">Modified yesterday • Product</p>
                </div>
                <a href="https://sharepoint.com/sites/yourteam/Shared%20Documents/Innovation%20Sprint%20Brief.pptx" target="_blank" rel="noopener" class="text-xs font-semibold text-emerald-600 hover:text-emerald-700">Open</a>
              </li>
              <li class="flex items-center justify-between rounded-lg border border-slate-200 px-4 py-3">
                <div>
                  <p class="font-semibold text-slate-900">Sustainability Roadmap.pdf</p>
                  <p class="text-xs text-slate-500">Modified 4 days ago • ESG Office</p>
                </div>
                <a href="https://sharepoint.com/sites/yourteam/Shared%20Documents/Sustainability%20Roadmap.pdf" target="_blank" rel="noopener" class="text-xs font-semibold text-emerald-600 hover:text-emerald-700">Open</a>
              </li>
            </ul>
          </div>
        </section>
      </section>
    </main>
      </div>
    </div>
    <script>
      ;(() => {
        const storedName = localStorage.getItem('pm-user-name')
        const defaultName = 'Renad Alm.'
        const nameToShow = storedName && storedName.trim().length ? storedName : defaultName

        document.querySelectorAll('[data-user-name]').forEach((el) => {
          el.textContent = nameToShow
        })

        const initials = nameToShow
          .split(/\s+/)
          .filter(Boolean)
          .map((segment) => segment.charAt(0).toUpperCase())
          .join('')
          .slice(0, 2)

        document.querySelectorAll('[data-user-initials]').forEach((el) => {
          el.textContent = initials || 'RA'
        })

        const firstName = nameToShow.split(/\s+/).filter(Boolean)[0] || 'there'
        const hour = new Date().getHours()
        const greeting =
          hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening'

        document.querySelectorAll('[data-dashboard-greeting]').forEach((el) => {
          el.textContent = `${greeting}, ${firstName}.`
        })

        document.querySelectorAll('[data-dashboard-subtitle]').forEach((el) => {
          el.textContent = "Let's craft something remarkable today."
        })

        const navLinks = document.querySelectorAll('[data-nav-link]')
        const activeClasses = ['bg-emerald-500/10', 'text-emerald-700', 'ring-1', 'ring-emerald-500/30', 'font-semibold']
        const inactiveClasses = ['text-slate-600', 'font-medium']

        function applyNavState(link, isActive) {
          activeClasses.forEach((cls) => link.classList.toggle(cls, isActive))
          inactiveClasses.forEach((cls) => link.classList.toggle(cls, !isActive))
        }

        function activateNav(id) {
          navLinks.forEach((link) => {
            applyNavState(link, link.dataset.navLink === id)
          })
        }

        navLinks.forEach((link) => {
          const href = link.getAttribute('href') || ''
          if (href.startsWith('#')) {
            link.addEventListener('click', (event) => {
              event.preventDefault()
              const target = document.querySelector(href)
              if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' })
              }
              activateNav(link.dataset.navLink)
            })
          } else {
            link.addEventListener('click', () => activateNav(link.dataset.navLink))
          }
        })

        const quickActionsRoot = document.querySelector('[data-quick-actions]')
        const actionMessage = document.querySelector('[data-action-message]')
        const actionMessageText = document.querySelector('[data-action-message-text]')
        const actionIndicator = document.querySelector('[data-action-indicator]')
        const importInput = document.getElementById('quick-import-input')

        const messageVariants = {
          success: {
            container: ['bg-emerald-50', 'border-emerald-200', 'text-emerald-700'],
            indicator: 'bg-emerald-500',
          },
          info: {
            container: ['bg-sky-50', 'border-sky-200', 'text-sky-700'],
            indicator: 'bg-sky-500',
          },
          warning: {
            container: ['bg-amber-50', 'border-amber-200', 'text-amber-700'],
            indicator: 'bg-amber-500',
          },
        }

        function resetMessageState() {
          actionMessage?.classList.add('hidden')
          actionMessage?.classList.remove(
            'bg-emerald-50',
            'border-emerald-200',
            'text-emerald-700',
            'bg-sky-50',
            'border-sky-200',
            'text-sky-700',
            'bg-amber-50',
            'border-amber-200',
            'text-amber-700'
          )
        }

        function showActionMessage(type, text) {
          if (!actionMessage || !actionIndicator || !actionMessageText) return
          const variant = messageVariants[type] || messageVariants.info

          resetMessageState()
          actionMessage.classList.remove('hidden')
          actionMessage.classList.add('border')
          actionMessageText.textContent = text

          variant.container.forEach((cls) => actionMessage.classList.add(cls))
          actionIndicator.className = `h-2 w-2 rounded-full ${variant.indicator}`
        }

        quickActionsRoot?.querySelectorAll('[data-action]').forEach((button) => {
          button.addEventListener('click', () => {
            const action = button.dataset.action

            if (action === 'import') {
              importInput?.click()
              return
            }

            if (action === 'share') {
              const recipient = window.prompt('Who would you like to share with? Enter an email address:')
              if (recipient && recipient.trim().length) {
                showActionMessage('success', `Invitation sent to ${recipient.trim()}.`)
              } else {
                showActionMessage('warning', 'Share cancelled—no email address provided.')
              }
              return
            }

            if (action === 'schedule') {
              const confirmed = window.confirm('Open your calendar to schedule a review?')
              if (confirmed) {
                window.open('https://outlook.office.com/calendar/', '_blank', 'noopener')
                showActionMessage('info', 'Calendar opened in a new tab to schedule your review.')
              } else {
                showActionMessage('warning', 'Review scheduling cancelled.')
              }
            }
          })
        })

        importInput?.addEventListener('change', (event) => {
          const files = event.target.files
          if (files && files.length > 0) {
            const fileNames = Array.from(files)
              .map((file) => file.name)
              .join(', ')
            showActionMessage('success', `Imported ${fileNames}. Ready to upload.`)
            importInput.value = ''
          } else {
            showActionMessage('warning', 'No file selected for import.')
          }
        })

        const cloudConnectBtn = document.querySelector('[data-cloud-connect]')
        const cloudEmptyState = document.querySelector('[data-cloud-empty]')
        const cloudFilesState = document.querySelector('[data-cloud-files]')
        const cloudUserLabel = document.querySelector('[data-cloud-user]')
        const cloudDisconnectBtn = document.querySelector('[data-cloud-disconnect]')
        const CLOUD_STORAGE_KEY = 'pm-cloud-connection'

        function updateCloudUI(connection) {
          const isConnected = Boolean(connection)
          if (cloudEmptyState) {
            cloudEmptyState.classList.toggle('hidden', isConnected)
          }
          if (cloudFilesState) {
            cloudFilesState.classList.toggle('hidden', !isConnected)
          }
          if (cloudConnectBtn) {
            cloudConnectBtn.textContent = isConnected ? 'Manage connection' : 'Connect account'
            cloudConnectBtn.dataset.connected = isConnected ? 'true' : 'false'
          }
          if (cloudUserLabel) {
            cloudUserLabel.textContent = connection?.email ?? ''
          }
        }

        function getStoredConnection() {
          try {
            const raw = localStorage.getItem(CLOUD_STORAGE_KEY)
            return raw ? JSON.parse(raw) : null
          } catch (error) {
            console.error('Failed to read cloud connection', error)
            return null
          }
        }

        function storeConnection(connection) {
          if (connection) {
            localStorage.setItem(CLOUD_STORAGE_KEY, JSON.stringify(connection))
          } else {
            localStorage.removeItem(CLOUD_STORAGE_KEY)
          }
        }

        const cachedConnection = getStoredConnection()
        updateCloudUI(cachedConnection)

        cloudConnectBtn?.addEventListener('click', (event) => {
          event.preventDefault()
          const isConnected = cloudConnectBtn.dataset.connected === 'true'

          if (isConnected) {
            const reconnect = window.confirm('You are already connected. Do you want to re-connect with a different account?')
            if (!reconnect) return
          }

          const email = window.prompt('Enter your SharePoint email to connect:')
          if (!email || !email.trim().length) {
            showActionMessage('warning', 'Connection cancelled—no email entered.')
            return
          }

          const connection = {
            email: email.trim(),
            connectedAt: new Date().toISOString(),
          }
          storeConnection(connection)
          updateCloudUI(connection)
          showActionMessage('success', `Connected to SharePoint as ${connection.email}.`)
        })

        cloudDisconnectBtn?.addEventListener('click', () => {
          const disconnect = window.confirm('Disconnect your SharePoint account?')
          if (!disconnect) return

          storeConnection(null)
          updateCloudUI(null)
          showActionMessage('info', 'Cloud connection removed.')
        })

        activateNav('recent')
      })()
    </script>
    <script type="module">
      import { collection, query, orderBy, limit, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

      const presentationsListEl = document.querySelector('[data-user-presentations-list]');
      const emptyStateEl = document.querySelector('[data-user-presentations-empty]');
      const loadingStateEl = document.querySelector('[data-user-presentations-loading]');
      const activeCountLabel = document.querySelector('[data-active-count-label]');

      let unsubscribe = null;
      let subscriptionUserId = null;

      const toDate = (value) => {
        if (!value) return null;
        if (value.toDate) return value.toDate();
        if (value instanceof Date) return value;
        return null;
      };

      const formatRelativeTime = (date) => {
        if (!date) return 'Just now';
        const diffMs = Date.now() - date.getTime();
        const diffMinutes = Math.max(0, Math.round(diffMs / 60000));
        if (diffMinutes < 1) return 'Just now';
        if (diffMinutes < 60) return `${diffMinutes} min${diffMinutes === 1 ? '' : 's'} ago`;
        const diffHours = Math.round(diffMinutes / 60);
        if (diffHours < 24) return `${diffHours} hr${diffHours === 1 ? '' : 's'} ago`;
        const diffDays = Math.round(diffHours / 24);
        if (diffDays < 7) return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
        return date.toLocaleDateString();
      };

      const updateActiveCount = (count) => {
        if (!activeCountLabel) return;
        const label = count === 1 ? '1 active deck' : `${count} active decks`;
        activeCountLabel.textContent = label;
      };

      const clearList = () => {
        if (!presentationsListEl) return;
        presentationsListEl.innerHTML = '';
      };

      const createPresentationCard = (docId, data) => {
        const title = (data?.title || '').trim() || 'Untitled presentation';
        const updatedAt = toDate(data?.updatedAt) || toDate(data?.createdAt);
        const updatedLabel = updatedAt ? formatRelativeTime(updatedAt) : 'Recently saved';
        const slideCount = Array.isArray(data?.slides) ? data.slides.length : 0;
        const slideLabel = slideCount === 1 ? 'slide' : 'slides';

        const card = document.createElement('div');
        card.className = 'group flex flex-col justify-between rounded-xl border border-slate-200 bg-white p-4 shadow-sm transition hover:-translate-y-1 hover:border-emerald-400 hover:shadow-md';

        const header = document.createElement('div');
        header.className = 'flex flex-col gap-2';
        const titleEl = document.createElement('h3');
        titleEl.className = 'font-semibold leading-tight text-slate-900';
        titleEl.textContent = title;
        header.appendChild(titleEl);

        const metaEl = document.createElement('p');
        metaEl.className = 'text-xs text-slate-500';
        metaEl.textContent = `Updated ${updatedLabel}`;
        header.appendChild(metaEl);

        const pillRow = document.createElement('div');
        pillRow.className = 'mt-2 flex flex-wrap items-center gap-2';
        const slidesPill = document.createElement('span');
        slidesPill.className = 'inline-flex items-center gap-1 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700';
        slidesPill.textContent = `${slideCount} ${slideLabel}`;
        pillRow.appendChild(slidesPill);
        header.appendChild(pillRow);

        const footer = document.createElement('div');
        footer.className = 'mt-4 flex items-center justify-between gap-3';
        const openBtn = document.createElement('a');
        openBtn.href = `editor.html?presentationId=${encodeURIComponent(docId)}`;
        openBtn.className = 'inline-flex items-center rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-400';
        openBtn.textContent = 'Open deck';
        footer.appendChild(openBtn);

        card.appendChild(header);
        card.appendChild(footer);
        return card;
      };

      const renderSnapshot = (snapshot) => {
        updateActiveCount(snapshot?.size ?? 0);

        if (!presentationsListEl || !emptyStateEl) {
          return;
        }

        clearList();

        if (!snapshot || snapshot.empty) {
          presentationsListEl.classList.add('hidden');
          emptyStateEl.classList.remove('hidden');
          return;
        }

        emptyStateEl.classList.add('hidden');
        presentationsListEl.classList.remove('hidden');

        snapshot.forEach((docSnap) => {
          const card = createPresentationCard(docSnap.id, docSnap.data());
          presentationsListEl.appendChild(card);
        });
      };

      const ensureSubscription = (userId) => {
        if (!userId || subscriptionUserId === userId) {
          return;
        }
        if (!window.firebaseDb) {
          return;
        }

        if (unsubscribe) {
          unsubscribe();
          unsubscribe = null;
        }

        subscriptionUserId = userId;
        loadingStateEl?.classList.remove('hidden');
        presentationsListEl?.classList.add('hidden');
        emptyStateEl?.classList.add('hidden');

        const presentationsRef = collection(window.firebaseDb, 'users', userId, 'presentations');
        const q = query(presentationsRef, orderBy('updatedAt', 'desc'), limit(12));

        unsubscribe = onSnapshot(
          q,
          (snapshot) => {
            loadingStateEl?.classList.add('hidden');
            renderSnapshot(snapshot);
          },
          (error) => {
            console.error('Failed to load presentations:', error);
            loadingStateEl?.classList.add('hidden');
            if (emptyStateEl) {
              emptyStateEl.classList.remove('hidden');
              emptyStateEl.textContent = 'We could not load your decks right now. Please try again.';
            }
          }
        );
      };

      window.addEventListener('pm-user-ready', (event) => {
        const userId = event?.detail?.userId;
        if (userId) {
          ensureSubscription(userId);
        }
      });

      if (window.currentUserId) {
        ensureSubscription(window.currentUserId);
      }

      window.addEventListener('beforeunload', () => {
        if (unsubscribe) {
          unsubscribe();
        }
      });
    </script>
  </body>
</html>


